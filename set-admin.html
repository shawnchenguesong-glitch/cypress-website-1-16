<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>设置管理员权限</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        .btn {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 16px;
        }
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        .result {
            margin: 15px 0;
            padding: 10px;
            border-radius: 3px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>设置管理员权限</h1>
        
        <div class="section">
            <h2>设置指定用户为管理员</h2>
            <p>请输入要设置为管理员的用户邮箱：</p>
            <input type="email" id="user-email" placeholder="用户邮箱" value="bbc_1125@qq.com">
            <button class="btn btn-primary" onclick="setUserAsAdmin()">设置为管理员</button>
        </div>
        
        <div class="section">
            <h2>快速操作</h2>
            <button class="btn btn-success" onclick="setDefaultAdmin()">设置默认用户为管理员</button>
            <button class="btn btn-info" onclick="showAllUsers()">查看所有用户</button>
            <button class="btn btn-danger" onclick="clearAllUsers()">清除所有用户（谨慎操作）</button>
        </div>
        
        <div id="result" class="result info">页面加载完成，等待操作...</div>
        
        <div class="section">
            <h2>当前登录用户</h2>
            <div id="current-user-info"></div>
        </div>
    </div>
    
    <!-- 引入认证相关功能 -->
    <script src="public/js/auth.js"></script>
    
    <script>
        function setUserAsAdmin() {
            const email = document.getElementById('user-email').value;
            const resultDiv = document.getElementById('result');
            
            if (!email) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '<strong>错误：</strong>请输入邮箱地址';
                return;
            }
            
            // 查找指定邮箱的用户
            const users = window.auth.getAllUsers();
            const targetUser = users.find(user => user.email === email);
            
            if (targetUser) {
                // 将用户角色改为admin
                targetUser.role = 'admin';
                
                // 更新用户数据
                window.auth.updateUser(targetUser);
                
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `<strong>成功：</strong>已将用户 ${targetUser.username} (${email}) 设置为管理员！`;
            } else {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<strong>错误：</strong>未找到邮箱为 ${email} 的用户`;
            }
        }
        

        
        function showAllUsers() {
            const users = window.auth.getAllUsers();
            const resultDiv = document.getElementById('result');
            
            if (users.length === 0) {
                resultDiv.className = 'result info';
                resultDiv.innerHTML = '<strong>提示：</strong>当前没有用户';
                return;
            }
            
            let html = '<strong>所有用户：</strong><br><br>';
            users.forEach((user, index) => {
                html += `<strong>${index + 1}. ${user.username}</strong><br>`;
                html += `   邮箱：${user.email}<br>`;
                html += `   角色：${user.role === 'admin' ? '管理员' : '普通用户'}<br>`;
                html += `   ID：${user.id}<br>`;
                html += `   注册时间：${new Date(user.createdAt).toLocaleString()}<br><br>`;
            });
            
            resultDiv.className = 'result info';
            resultDiv.innerHTML = html;
        }
        
        function clearAllUsers() {
            if (confirm('确定要清除所有用户吗？此操作不可恢复！')) {
                localStorage.removeItem('users');
                localStorage.removeItem('currentUser');
                const resultDiv = document.getElementById('result');
                resultDiv.className = 'result info';
                resultDiv.innerHTML = '<strong>提示：</strong>已清除所有用户数据';
            }
        }
        
        // 显示当前登录用户信息
        function showCurrentUser() {
            const user = window.auth.getCurrentUser();
            const currentUserInfo = document.getElementById('current-user-info');
            
            if (user) {
                currentUserInfo.innerHTML = `
                    <p><strong>用户名：</strong>${user.username}</p>
                    <p><strong>邮箱：</strong>${user.email}</p>
                    <p><strong>角色：</strong>${user.role === 'admin' ? '管理员' : '普通用户'}</p>
                    <p><strong>注册时间：</strong>${new Date(user.createdAt).toLocaleString()}</p>
                `;
            } else {
                currentUserInfo.innerHTML = '<p>当前未登录</p>';
            }
        }
        
        // 设置默认用户为管理员
        function setDefaultAdmin() {
            const email = 'bbc_1125@qq.com';
            const resultDiv = document.getElementById('result');
            
            // 查找指定邮箱的用户
            const users = window.auth.getAllUsers();
            const targetUser = users.find(user => user.email === email);
            
            if (targetUser) {
                // 将用户角色改为admin
                targetUser.role = 'admin';
                
                // 更新用户数据
                window.auth.updateUser(targetUser);
                
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `<strong>成功：</strong>已将用户 ${targetUser.username} (${email}) 设置为管理员！`;
            } else {
                // 如果用户不存在，创建一个新的管理员用户
                const newAdmin = {
                    id: window.auth.generateId(),
                    username: '保诚bbc',
                    email: email,
                    password: '$2a$10$examplehashedpassword', // 实际使用时需要修改
                    role: 'admin',
                    createdAt: new Date().toISOString()
                };
                
                window.auth.addUser(newAdmin);
                
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `<strong>成功：</strong>已创建新的管理员用户 ${newAdmin.username} (${email})！`;
            }
            
            // 更新当前用户信息显示
            showCurrentUser();
            showAllUsers();
        }
        
        // 页面加载时显示所有用户和当前登录用户
        window.addEventListener('load', () => {
            showAllUsers();
            showCurrentUser();
        });
    </script>
</body>
</html>